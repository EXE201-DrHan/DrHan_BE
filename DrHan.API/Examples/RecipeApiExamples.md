# Recipe Search API Examples

This document provides examples of how to use the Recipe Search API with Gemini AI integration.

## Prerequisites

1. Configure your Gemini API key in `appsettings.json`:
```json
{
  "Gemini": {
    "ApiKey": "your-actual-gemini-api-key-here"
  }
}
```

2. Ensure the database is set up and migrations are applied.

## API Endpoints

### 1. Search Recipes
`GET /api/recipes/search`

#### Basic Search
```http
GET /api/recipes/search?searchTerm=chicken&page=1&pageSize=10
```

#### Advanced Search with Filters
```http
GET /api/recipes/search?searchTerm=pasta&cuisineType=Italian&maxPrepTime=30&difficultyLevel=Easy&page=1&pageSize=20
```

#### Search with Allergen Filtering
```http
GET /api/recipes/search?searchTerm=dessert&excludeAllergens=Dairy,Gluten&requireAllergenFree=Gluten-Free&page=1&pageSize=10
```

#### Search with Sorting
```http
GET /api/recipes/search?searchTerm=healthy&sortBy=rating&isDescending=true&page=1&pageSize=15
```

#### Response Example
```json
{
  "isSucceeded": true,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {
    "Success": ["Results include recipes from AI generation"]
  },
  "data": {
    "items": [
      {
        "id": 1,
        "businessId": "123e4567-e89b-12d3-a456-426614174000",
        "name": "Chicken Parmesan",
        "description": "Classic Italian-American dish with breaded chicken and marinara sauce",
        "cuisineType": "Italian",
        "mealType": "Dinner",
        "prepTimeMinutes": 20,
        "cookTimeMinutes": 30,
        "servings": 4,
        "difficultyLevel": "Medium",
        "ratingAverage": 4.5,
        "ratingCount": 23,
        "likesCount": 156,
        "savesCount": 89,
        "isCustom": false,
        "isPublic": true,
        "createAt": "2024-01-15T08:00:00Z",
        "updateAt": "2024-01-15T08:00:00Z",
        "thumbnailImageUrl": "https://example.com/images/chicken-parmesan.jpg"
      }
    ],
    "pageNumber": 1,
    "pageSize": 10,
    "totalCount": 45,
    "totalPages": 5,
    "hasPreviousPage": false,
    "hasNextPage": true
  },
  "pagination": {
    "pageNumber": 1,
    "pageSize": 10,
    "totalCount": 45,
    "totalPages": 5,
    "hasPreviousPage": false,
    "hasNextPage": true
  }
}
```

### 2. Get Recipe by ID
`GET /api/recipes/{id}`

```http
GET /api/recipes/1
```

#### Response Example
```json
{
  "isSucceeded": true,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {},
  "data": {
    "id": 1,
    "businessId": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Chicken Parmesan",
    "description": "Classic Italian-American dish with breaded chicken and marinara sauce",
    "cuisineType": "Italian",
    "mealType": "Dinner",
    "prepTimeMinutes": 20,
    "cookTimeMinutes": 30,
    "servings": 4,
    "difficultyLevel": "Medium",
    "ratingAverage": 4.5,
    "ratingCount": 23,
    "likesCount": 156,
    "savesCount": 89,
    "isCustom": false,
    "isPublic": true,
    "createAt": "2024-01-15T08:00:00Z",
    "updateAt": "2024-01-15T08:00:00Z",
    "sourceUrl": "Generated by AI",
    "originalAuthor": "AI Generated",
    "author": null,
    "ingredients": [
      {
        "name": "Chicken breast",
        "quantity": 4,
        "unit": "pieces",
        "notes": "Boneless, skinless",
        "orderIndex": 1
      },
      {
        "name": "Breadcrumbs",
        "quantity": 1,
        "unit": "cup",
        "notes": "Italian seasoned",
        "orderIndex": 2
      }
    ],
    "instructions": [
      {
        "stepNumber": 1,
        "instruction": "Preheat oven to 425°F (220°C)",
        "estimatedTimeMinutes": 5
      },
      {
        "stepNumber": 2,
        "instruction": "Pound chicken breasts to even thickness",
        "estimatedTimeMinutes": 10
      }
    ],
    "nutrition": [
      {
        "nutrientName": "Calories",
        "amount": 450,
        "unit": "kcal",
        "dailyValuePercentage": 22.5
      },
      {
        "nutrientName": "Protein",
        "amount": 35,
        "unit": "g",
        "dailyValuePercentage": 70
      }
    ],
    "allergens": ["Gluten", "Dairy"],
    "allergenFreeClaims": [],
    "images": [
      {
        "imageUrl": "https://example.com/images/chicken-parmesan-main.jpg",
        "imageDescription": "Finished chicken parmesan on plate",
        "isPrimary": true,
        "orderIndex": 1
      }
    ]
  }
}
```

### 3. Get Filter Options
`GET /api/recipes/filter-options`

```http
GET /api/recipes/filter-options
```

#### Response Example
```json
{
  "isSucceeded": true,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {},
  "data": {
    "cuisineTypes": [
      "Italian", "Chinese", "Mexican", "Indian", "French", "Thai", "Japanese",
      "Mediterranean", "American", "Greek", "Korean", "Vietnamese", "Spanish"
    ],
    "mealTypes": [
      "Breakfast", "Lunch", "Dinner", "Snack", "Dessert", "Appetizer", "Beverage"
    ],
    "difficultyLevels": [
      "Easy", "Medium", "Hard"
    ],
    "sortOptions": [
      "Name", "Rating", "PrepTime", "CookTime", "Likes"
    ]
  }
}
```

## How the Gemini Integration Works

1. **Primary Search**: The system first searches the local database for recipes matching your criteria.

2. **AI Augmentation**: If insufficient results are found (less than the requested page size) and you're on the first page, the system automatically:
   - Calls the Gemini API with your search parameters
   - Generates new recipes based on your criteria
   - Saves them to the database for future searches
   - Returns combined results (database + AI-generated)

3. **Background Population**: A background service periodically populates the database with popular recipes using common search terms.

## Query Parameters

### Search Parameters
- `searchTerm`: Free text search across recipe names, descriptions, and ingredients
- `cuisineType`: Filter by cuisine (Italian, Chinese, etc.)
- `mealType`: Filter by meal type (Breakfast, Lunch, Dinner, etc.)
- `difficultyLevel`: Filter by difficulty (Easy, Medium, Hard)
- `maxPrepTime`: Maximum preparation time in minutes
- `maxCookTime`: Maximum cooking time in minutes
- `minServings`: Minimum number of servings
- `maxServings`: Maximum number of servings
- `excludeAllergens`: Array of allergens to exclude
- `requireAllergenFree`: Array of allergen-free claims required
- `isCustom`: Filter custom recipes (true/false)
- `isPublic`: Filter public recipes (true/false)
- `minRating`: Minimum average rating (0-5)

### Sorting Parameters
- `sortBy`: Field to sort by (Name, Rating, PrepTime, CookTime, Likes)
- `isDescending`: Sort direction (true for descending, false for ascending)

### Pagination Parameters
- `page`: Page number (starts from 1)
- `pageSize`: Number of items per page (1-100)

## Error Handling

### Validation Errors
```json
{
  "isSucceeded": false,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {
    "Page": ["Page must be greater than 0"],
    "PageSize": ["Page size must be between 1 and 100"]
  },
  "data": null
}
```

### Not Found
```json
{
  "isSucceeded": false,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {
    "NotFound": ["Recipe not found"]
  },
  "data": null
}
```

### Server Error
```json
{
  "isSucceeded": false,
  "timestamp": "2024-01-15T10:30:00Z",
  "messages": {
    "Error": ["An unexpected error occurred while searching recipes"]
  },
  "data": null
}
```

## Performance Notes

- **Database First**: Local database searches are fast and always executed first
- **AI Fallback**: Gemini API is only called when needed (insufficient local results)
- **Caching**: AI-generated recipes are saved for future searches
- **Rate Limiting**: Built-in delays between API calls to respect Gemini's limits
- **Background Processing**: Popular recipes are pre-populated during low-traffic periods

## Configuration

Update your `appsettings.json`:

```json
{
  "Gemini": {
    "ApiKey": "your-gemini-api-key-here"
  },
  "DatabaseSettings": {
    "AutoMigrate": true,
    "AutoSeed": true
  }
}
```

## Testing the API

### Using curl
```bash
# Basic search
curl -X GET "https://localhost:7000/api/recipes/search?searchTerm=chicken&page=1&pageSize=10"

# Advanced search
curl -X GET "https://localhost:7000/api/recipes/search?searchTerm=pasta&cuisineType=Italian&maxPrepTime=30&sortBy=rating&isDescending=true"

# Get specific recipe
curl -X GET "https://localhost:7000/api/recipes/1"
```

### Using Swagger
Navigate to `https://localhost:7000/swagger` to test the API interactively. 